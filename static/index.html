<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BUDDY AI Assistant</title>
    <meta name="description" content="Your intelligent personal assistant powered by AI">
    <meta name="theme-color" content="#4285f4">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="BUDDY AI">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="/static/manifest.json">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/responsive.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2b7cff;
            --primary-dark: #1a5dcc;
            --secondary-color: #f8f9fa;
            --accent-color: #28a745;
            --danger-color: #dc3545;
            --text-dark: #212529;
            --text-light: #6c757d;
            --border-color: #e9ecef;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.15);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            line-height: 1.6;
        }

        .chat-container {
            width: 100%;
            max-width: 800px;
            height: 90vh;
            max-height: 700px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: var(--transition);
        }

        .chat-container:hover {
            box-shadow: var(--shadow-hover);
        }

        .chat-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.5rem 2rem;
            text-align: center;
            position: relative;
        }

        .chat-header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .chat-header .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 300;
        }

        .status-indicator {
            position: absolute;
            top: 1rem;
            right: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-color);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            background: var(--secondary-color);
            scroll-behavior: smooth;
        }

        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }

        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #999;
        }

        .message {
            margin-bottom: 1rem;
            display: flex;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 75%;
            padding: 0.875rem 1.25rem;
            border-radius: 18px;
            word-wrap: break-word;
            position: relative;
        }

        .message.user .message-content {
            background: var(--primary-color);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message.bot .message-content {
            background: white;
            color: var(--text-dark);
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin: 0 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: var(--primary-dark);
            color: white;
            order: 2;
        }

        .message.bot .message-avatar {
            background: var(--accent-color);
            color: white;
        }

        .typing-indicator {
            display: none;
            padding: 1rem;
            color: var(--text-light);
            font-style: italic;
            align-items: center;
            gap: 0.5rem;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 6px;
            height: 6px;
            background: var(--text-light);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { opacity: 0.3; }
            40% { opacity: 1; }
        }

        .chat-input {
            padding: 1.5rem;
            background: white;
            border-top: 1px solid var(--border-color);
        }

        .input-container {
            display: flex;
            gap: 0.75rem;
            align-items: flex-end;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        #messageInput {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 25px;
            font-size: 1rem;
            resize: none;
            outline: none;
            transition: var(--transition);
            font-family: inherit;
            max-height: 120px;
            min-height: 45px;
        }

        #messageInput:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(43, 124, 255, 0.1);
        }

        #sendButton {
            width: 45px;
            height: 45px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            flex-shrink: 0;
        }

        #sendButton:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        #sendButton:disabled {
            background: var(--text-light);
            cursor: not-allowed;
            transform: scale(1);
        }

        .quick-actions {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
        }

        .quick-action-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .welcome-message {
            text-align: center;
            padding: 2rem;
            color: var(--text-light);
        }

        .welcome-message h3 {
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .feature-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid rgba(42, 117, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .feature-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 25px rgba(42, 117, 255, 0.2);
            border-color: var(--primary-color);
        }

        .feature-card:active {
            transform: translateY(-2px) scale(1.01);
        }

        .feature-card i {
            font-size: 1.8rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .feature-card:hover i {
            transform: scale(1.2) rotate(5deg);
            text-shadow: 0 0 20px rgba(42, 117, 255, 0.3);
        }

        .feature-card h4 {
            font-size: 0.9rem;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
            font-weight: 600;
        }

        .feature-card p {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .feature-example {
            font-size: 0.65rem;
            color: var(--primary-color);
            font-style: italic;
            margin-top: 0.5rem;
            padding: 0.25rem 0.5rem;
            background: rgba(42, 117, 255, 0.05);
            border-radius: 6px;
            border-left: 2px solid var(--primary-color);
        }

        .feature-shortcut {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary-color);
            color: white;
            font-size: 0.6rem;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .feature-card:hover .feature-shortcut {
            opacity: 1;
        }

        .feature-stats {
            position: absolute;
            bottom: 4px;
            right: 8px;
            font-size: 0.55rem;
            color: var(--text-light);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .feature-card:hover .feature-stats {
            opacity: 0.7;
        }

        /* Category-specific card colors */
        .weather-card:hover {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }

        .tasks-card:hover {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
        }

        .calendar-card:hover {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
        }

        .datetime-card:hover {
            background: linear-gradient(135deg, #fff3e0 0%, #ffcc80 100%);
        }

        .entertainment-card:hover {
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
        }

        .notes-card:hover {
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%);
        }

        .contacts-card:hover {
            background: linear-gradient(135deg, #e0f2f1 0%, #b2dfdb 100%);
        }

        .ai-card:hover {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }

            .chat-container {
                height: 100vh;
                max-height: none;
                border-radius: 0;
            }

            .chat-header {
                padding: 1rem;
            }

            .chat-header h1 {
                font-size: 1.25rem;
            }

            .status-indicator {
                top: 0.75rem;
                right: 1rem;
            }

            .message-content {
                max-width: 85%;
            }

            .chat-input {
                padding: 1rem;
            }

            .features-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 0.75rem;
            }

            .feature-card {
                padding: 0.75rem;
            }

            .feature-card h4 {
                font-size: 0.8rem;
            }

            .feature-card p {
                font-size: 0.7rem;
            }

            .feature-example {
                font-size: 0.6rem;
                padding: 0.2rem 0.4rem;
            }

            .feature-shortcut {
                font-size: 0.55rem;
                padding: 1px 4px;
            }

            .feature-stats {
                font-size: 0.5rem;
            }

            .quick-actions {
                gap: 0.25rem;
                flex-wrap: wrap;
            }

            .quick-action-btn {
                font-size: 0.75rem;
                padding: 0.4rem 0.6rem;
                min-height: 36px;
                white-space: nowrap;
            }

            /* Disable hover effects on mobile */
            .feature-card:hover {
                transform: none;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

            .feature-shortcut,
            .feature-stats {
                display: none; /* Hide on mobile for cleaner look */
            }
        }

        @media (max-width: 480px) {
            .message-content {
                max-width: 90%;
                font-size: 0.9rem;
            }

            .message-avatar {
                width: 28px;
                height: 28px;
                font-size: 0.8rem;
            }

            #messageInput {
                font-size: 0.9rem;
            }

            .features-grid {
                grid-template-columns: 1fr 1fr;
                gap: 0.5rem;
            }

            .feature-card {
                padding: 0.5rem;
                border-radius: 6px;
            }

            .feature-card h4 {
                font-size: 0.75rem;
            }

            .feature-card p {
                font-size: 0.65rem;
                margin-bottom: 0.25rem;
            }

            .feature-card i {
                font-size: 1.3rem;
            }

            .feature-example {
                font-size: 0.55rem;
                padding: 0.15rem 0.3rem;
                margin-top: 0.25rem;
            }

            .feature-shortcut,
            .feature-stats {
                display: none;
            }

            .quick-actions {
                overflow-x: auto;
                flex-wrap: nowrap;
                padding: 0.25rem 0;
                gap: 0.5rem;
            }

            .quick-action-btn {
                font-size: 0.7rem;
                padding: 0.3rem 0.5rem;
                min-width: auto;
                flex-shrink: 0;
            }

            /* Touch-friendly interactions */
            .feature-card:active {
                transform: scale(0.95);
                background: rgba(42, 117, 255, 0.05);
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --secondary-color: #1a1a1a;
                --text-dark: #e9ecef;
                --text-light: #adb5bd;
                --border-color: #343a40;
            }

            body {
                background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
            }

            .chat-container {
                background: #212529;
            }

            .message.bot .message-content {
                background: #343a40;
                color: var(--text-dark);
            }

            .chat-input {
                background: #212529;
                border-top-color: var(--border-color);
            }

            #messageInput {
                background: #343a40;
                color: var(--text-dark);
                border-color: var(--border-color);
            }

            .feature-card {
                background: #343a40;
            }

            .quick-action-btn {
                background: #343a40;
                color: var(--text-dark);
                border-color: var(--border-color);
            }
        }

        /* Accessibility improvements */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Advanced interaction enhancements */
        .message-actions {
            position: absolute;
            top: 5px;
            right: 10px;
            display: none;
            gap: 5px;
        }

        .message:hover .message-actions {
            display: flex;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 4px;
            padding: 3px 6px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-dark);
        }

        .action-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .suggestion-chips {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        .suggestion-chip {
            background: rgba(42, 117, 255, 0.1);
            border: 1px solid rgba(42, 117, 255, 0.2);
            border-radius: 16px;
            padding: 0.3rem 0.8rem;
            font-size: 0.75rem;
            color: var(--primary-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .suggestion-chip:hover {
            background: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        .voice-control {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: var(--accent-color);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
            z-index: 1000;
        }

        .voice-control:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-hover);
        }

        .voice-control.active {
            background: var(--danger-color);
            animation: pulse-record 1.5s infinite;
        }

        @keyframes pulse-record {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }

        .message-timestamp {
            font-size: 0.65rem;
            color: var(--text-light);
            margin-top: 0.25rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .message:hover .message-timestamp {
            opacity: 1;
        }

        .smart-notifications {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            max-width: 300px;
        }

        .notification {
            background: white;
            border-left: 4px solid var(--primary-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            box-shadow: var(--shadow);
            animation: slideInRight 0.3s ease-out;
            position: relative;
        }

        .notification.success {
            border-left-color: var(--accent-color);
        }

        .notification.error {
            border-left-color: var(--danger-color);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-close {
            position: absolute;
            top: 5px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .smart-search {
            position: relative;
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: var(--shadow);
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .search-suggestion {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s ease;
        }

        .search-suggestion:hover {
            background: var(--secondary-color);
        }

        .search-suggestion:last-child {
            border-bottom: none;
        }

        .feature-usage-indicator {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background: var(--accent-color);
            border-radius: 50%;
            font-size: 0.6rem;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
        }

        .feature-card:hover .feature-usage-indicator {
            opacity: 1;
            transform: scale(1);
        }

        .theme-toggle {
            position: absolute;
            top: 1rem;
            left: 2rem;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .chat-container.dark-theme {
            --secondary-color: #1a1a1a;
            --text-dark: #e9ecef;
            --text-light: #adb5bd;
            --border-color: #343a40;
        }

        .dark-theme {
            background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
        }

        .dark-theme .chat-container {
            background: #212529;
        }

        .dark-theme .message.bot .message-content {
            background: #343a40;
            color: var(--text-dark);
        }

        .dark-theme .chat-input {
            background: #212529;
            border-top-color: var(--border-color);
        }

        .dark-theme #messageInput {
            background: #343a40;
            color: var(--text-dark);
            border-color: var(--border-color);
        }

        .dark-theme .feature-card {
            background: #343a40;
        }

        .dark-theme .quick-action-btn {
            background: #343a40;
            color: var(--text-dark);
            border-color: var(--border-color);
        }

        /* Print styles */
        @media print {
            body {
                background: white;
            }

            .chat-container {
                box-shadow: none;
                height: auto;
                max-height: none;
            }

            .chat-input, .quick-actions, .voice-control, .theme-toggle {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark/light theme">
                <i class="fas fa-moon"></i> Theme
            </button>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>Online</span>
            </div>
            <h1>
                <i class="fas fa-robot"></i>
                BUDDY AI Assistant
            </h1>
            <p class="subtitle">Your intelligent companion for weather, tasks, and more</p>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="welcome-message">
                <h3>👋 Welcome to BUDDY AI!</h3>
                <p>I'm here to help you with weather updates, jokes, quotes, task management, and much more. What would you like to know?</p>
                
                <div class="features-grid">
                    <div class="feature-card weather-card" onclick="handleFeatureClick('weather')" 
                         onmouseenter="showFeaturePreview('weather')" 
                         onmouseleave="hideFeaturePreview()"
                         data-category="weather" title="Click to check weather">
                        <i class="fas fa-cloud-sun"></i>
                        <h4>Weather & Forecast</h4>
                        <p>Real-time weather conditions, temperature, humidity, and 7-day forecasts</p>
                        <div class="feature-example">🌡️ "Weather in Madurai" | 🌦️ "Tomorrow's forecast" | 🌍 "Global weather"</div>
                        <div class="feature-shortcut">Alt+W</div>
                        <div class="feature-stats">Updated every 10 minutes</div>
                        <div class="feature-usage-indicator">12</div>
                    </div>
                    <div class="feature-card tasks-card" onclick="handleFeatureClick('tasks')" 
                         onmouseenter="showFeaturePreview('tasks')" 
                         onmouseleave="hideFeaturePreview()"
                         data-category="tasks" title="Click to manage tasks">
                        <i class="fas fa-tasks"></i>
                        <h4>Task Management</h4>
                        <p>Create, organize, and track your to-do lists with smart reminders</p>
                        <div class="feature-example">✅ "Add task: Call mom" | 📋 "Show my tasks" | ⏰ "Set reminder"</div>
                        <div class="feature-shortcut">Alt+T</div>
                        <div class="feature-stats">Smart prioritization</div>
                        <div class="feature-usage-indicator">8</div>
                    </div>
                    <div class="feature-card calendar-card" onclick="handleFeatureClick('calendar')" 
                         onmouseenter="showFeaturePreview('calendar')" 
                         onmouseleave="hideFeaturePreview()"
                         data-category="calendar" title="Click to view calendar">
                        <i class="fas fa-calendar-alt"></i>
                        <h4>Calendar & Events</h4>
                        <p>Schedule appointments, meetings, and events with intelligent planning</p>
                        <div class="feature-example">📅 "Add meeting at 3 PM" | 🗓️ "What's my schedule?" | ⏰ "Free time today"</div>
                        <div class="feature-shortcut">Alt+C</div>
                        <div class="feature-stats">Conflict detection</div>
                        <div class="feature-usage-indicator">5</div>
                    </div>
                    <div class="feature-card datetime-card" onclick="handleFeatureClick('datetime')" 
                         onmouseenter="showFeaturePreview('datetime')" 
                         onmouseleave="hideFeaturePreview()"
                         data-category="datetime" title="Click to check time">
                        <i class="fas fa-clock"></i>
                        <h4>Date & Time</h4>
                        <p>Current time, timezone conversion, and date calculations worldwide</p>
                        <div class="feature-example">🕐 "What time is it?" | 🌍 "Time in Tokyo" | 📊 "Days until Christmas"</div>
                        <div class="feature-shortcut">Alt+D</div>
                        <div class="feature-stats">Real-time updates</div>
                        <div class="feature-usage-indicator">15</div>
                    </div>
                    <div class="feature-card entertainment-card" onclick="handleFeatureClick('entertainment')" 
                         onmouseenter="showFeaturePreview('entertainment')" 
                         onmouseleave="hideFeaturePreview()"
                         data-category="entertainment" title="Click for entertainment">
                        <i class="fas fa-laugh"></i>
                        <h4>Entertainment Hub</h4>
                        <p>Jokes, inspirational quotes, fun facts, and engaging conversations</p>
                        <div class="feature-example">😂 "Tell me a programming joke" | ✨ "Inspire me" | 🎯 "Random fact"</div>
                        <div class="feature-shortcut">Alt+E</div>
                        <div class="feature-stats">Daily updates</div>
                        <div class="feature-usage-indicator">22</div>
                    </div>
                    <div class="feature-card notes-card" onclick="handleFeatureClick('notes')" 
                         onmouseenter="showFeaturePreview('notes')" 
                         onmouseleave="hideFeaturePreview()"
                         data-category="notes" title="Click to manage notes">
                        <i class="fas fa-sticky-note"></i>
                        <h4>Smart Notes</h4>
                        <p>Save, organize, and search through your important information</p>
                        <div class="feature-example">📝 "Save note: Meeting notes" | 🔍 "Find notes about project" | 📚 "All notes"</div>
                        <div class="feature-shortcut">Alt+N</div>
                        <div class="feature-stats">AI-powered search</div>
                        <div class="feature-usage-indicator">7</div>
                    </div>
                    <div class="feature-card contacts-card" onclick="handleFeatureClick('contacts')" 
                         onmouseenter="showFeaturePreview('contacts')" 
                         onmouseleave="hideFeaturePreview()"
                         data-category="contacts" title="Click to manage contacts">
                        <i class="fas fa-address-book"></i>
                        <h4>Contact Manager</h4>
                        <p>Store and organize contacts with smart search and grouping</p>
                        <div class="feature-example">👤 "Add contact: John Smith" | 🔍 "Find Sarah's number" | 📱 "All contacts"</div>
                        <div class="feature-shortcut">Alt+O</div>
                        <div class="feature-stats">Smart grouping</div>
                        <div class="feature-usage-indicator">3</div>
                    </div>
                    <div class="feature-card ai-card" onclick="handleFeatureClick('ai')" 
                         onmouseenter="showFeaturePreview('ai')" 
                         onmouseleave="hideFeaturePreview()"
                         data-category="ai" title="Click for AI assistance">
                        <i class="fas fa-brain"></i>
                        <h4>AI Intelligence</h4>
                        <p>Advanced AI assistance for research, analysis, and problem-solving</p>
                        <div class="feature-example">🧠 "Explain quantum physics" | 💡 "Help plan my day" | 🔬 "Research AI trends"</div>
                        <div class="feature-shortcut">Alt+A</div>
                        <div class="feature-stats">Always learning</div>
                        <div class="feature-usage-indicator">18</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <i class="fas fa-robot"></i>
            <span>BUDDY is thinking</span>
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="chat-input">
            <div class="quick-actions">
                <button class="quick-action-btn" onclick="sendQuickMessage('What\'s the weather in Madurai?')" title="Get Madurai weather">
                    <i class="fas fa-cloud-sun"></i> Madurai Weather
                </button>
                <button class="quick-action-btn" onclick="sendQuickMessage('What\'s the weather in Chennai?')" title="Get Chennai weather">
                    <i class="fas fa-thermometer-half"></i> Chennai Weather
                </button>
                <button class="quick-action-btn" onclick="sendQuickMessage('What time is it now?')" title="Current time and date">
                    <i class="fas fa-clock"></i> Current Time
                </button>
                <button class="quick-action-btn" onclick="sendQuickMessage('Add task: Call mom')" title="Quick task example">
                    <i class="fas fa-plus-circle"></i> Add Task
                </button>
                <button class="quick-action-btn" onclick="sendQuickMessage('Tell me a programming joke')" title="Get a tech joke">
                    <i class="fas fa-code"></i> Tech Joke
                </button>
                <button class="quick-action-btn" onclick="sendQuickMessage('Show my schedule for today')" title="View today's schedule">
                    <i class="fas fa-calendar-day"></i> Today's Schedule
                </button>
                <button class="quick-action-btn" onclick="sendQuickMessage('Inspire me with a motivational quote')" title="Get inspiration">
                    <i class="fas fa-star"></i> Motivate Me
                </button>
            </div>
            
            <div class="input-container">
                <div class="input-wrapper smart-search">
                    <textarea 
                        id="messageInput" 
                        placeholder="Type your message here..." 
                        rows="1"
                        autocomplete="off"
                        spellcheck="true"
                    ></textarea>
                    <div class="search-suggestions" id="searchSuggestions"></div>
                </div>
                <button id="sendButton" type="button" aria-label="Send message">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Voice Control Button -->
    <button class="voice-control" id="voiceButton" onclick="toggleVoiceRecording()" title="Voice input (Click to start/stop)">
        <i class="fas fa-microphone"></i>
    </button>

    <!-- Smart Notifications Container -->
    <div class="smart-notifications" id="notificationsContainer"></div>

    <script>
        class BuddyChatUI {
            constructor() {
                this.chatMessages = document.getElementById('chatMessages');
                this.messageInput = document.getElementById('messageInput');
                this.sendButton = document.getElementById('sendButton');
                this.typingIndicator = document.getElementById('typingIndicator');
                this.searchSuggestions = document.getElementById('searchSuggestions');
                this.notificationsContainer = document.getElementById('notificationsContainer');
                
                this.isTyping = false;
                this.messageQueue = [];
                this.isRecording = false;
                this.recognition = null;
                this.suggestionTimeout = null;
                
                this.initializeEventListeners();
                this.initializeVoiceRecognition();
                this.initializeSmartSuggestions();
                this.adjustTextareaHeight();
                this.loadThemePreference();
            }

            initializeEventListeners() {
                // Send button click
                this.sendButton.addEventListener('click', () => this.sendMessage());
                
                // Enter key to send (Shift+Enter for new line)
                this.messageInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                // Auto-resize textarea and show suggestions with smart formatting
                this.messageInput.addEventListener('input', () => {
                    this.adjustTextareaHeight();
                    this.updateSendButtonState();
                    this.showSmartSuggestions();
                    this.handleSmartFormatting();
                });

                // Handle smart formatting for common queries
                this.messageInput.addEventListener('blur', () => {
                    this.applySmartFormatting();
                });

                // Hide suggestions when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.smart-search')) {
                        this.hideSuggestions();
                    }
                });

                // Initial button state
                this.updateSendButtonState();
            }

            initializeVoiceRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'en-US';

                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        this.messageInput.value = transcript;
                        this.adjustTextareaHeight();
                        this.updateSendButtonState();
                        this.showNotification('Voice input captured: "' + transcript + '"', 'success');
                    };

                    this.recognition.onerror = (event) => {
                        this.showNotification('Voice recognition error: ' + event.error, 'error');
                        this.stopVoiceRecording();
                    };

                    this.recognition.onend = () => {
                        this.stopVoiceRecording();
                    };
                } else {
                    document.getElementById('voiceButton').style.display = 'none';
                }
            }

            initializeSmartSuggestions() {
                this.commonSuggestions = [
                    "What's the weather like today?",
                    "Weather in Madurai",
                    "Weather in Chennai", 
                    "Weather in London",
                    "Weather in Tokyo",
                    "Current temperature in Madurai",
                    "Show my tasks for today",
                    "What time is it?",
                    "Tell me a joke",
                    "Add a new task",
                    "What's my schedule?",
                    "Inspire me with a quote",
                    "Help me plan my day",
                    "Check the forecast",
                    "Save a note",
                    "Find my contacts",
                    "Research something",
                    "Today's weather forecast",
                    "Humidity and temperature",
                    "Wind speed today",
                    "Weekly weather outlook",
                    "Is it going to rain?",
                    "Best time to go outside",
                    "Weather comparison between cities"
                ];
                
                // Popular locations for weather queries
                this.popularLocations = [
                    "Madurai", "Chennai", "London", "Tokyo", "New York", 
                    "Mumbai", "Delhi", "Bangalore", "Paris", "Sydney",
                    "Singapore", "Dubai", "Berlin", "Vancouver", "Toronto"
                ];
            }

            loadThemePreference() {
                const savedTheme = localStorage.getItem('buddyTheme');
                if (savedTheme === 'dark') {
                    this.toggleTheme(false);
                }
            }

            adjustTextareaHeight() {
                this.messageInput.style.height = '45px';
                const scrollHeight = this.messageInput.scrollHeight;
                this.messageInput.style.height = Math.min(scrollHeight, 120) + 'px';
            }

            updateSendButtonState() {
                const hasText = this.messageInput.value.trim().length > 0;
                this.sendButton.disabled = !hasText || this.isTyping;
            }

            showSmartSuggestions() {
                clearTimeout(this.suggestionTimeout);
                const query = this.messageInput.value.trim().toLowerCase();
                
                if (query.length < 2) {
                    this.hideSuggestions();
                    return;
                }

                this.suggestionTimeout = setTimeout(() => {
                    let matches = [];
                    
                    // Smart weather location detection
                    if (query.includes('weather') || query.includes('temperature') || query.includes('forecast')) {
                        // Add location-specific weather suggestions
                        const locationMatches = this.popularLocations
                            .filter(location => location.toLowerCase().includes(query.replace(/weather|temperature|forecast/gi, '').trim()))
                            .map(location => `Weather in ${location}`)
                            .slice(0, 3);
                        matches.push(...locationMatches);
                        
                        // Add general weather suggestions
                        const weatherSuggestions = [
                            "Weather in Madurai",
                            "Weather in Chennai", 
                            "Today's weather forecast",
                            "Current temperature",
                            "Humidity levels"
                        ].filter(s => s.toLowerCase().includes(query)).slice(0, 2);
                        matches.push(...weatherSuggestions);
                    }
                    
                    // Add general suggestions
                    const generalMatches = this.commonSuggestions
                        .filter(suggestion => suggestion.toLowerCase().includes(query))
                        .slice(0, 3);
                    matches.push(...generalMatches);
                    
                    // Remove duplicates and limit to 5
                    matches = [...new Set(matches)].slice(0, 5);

                    if (matches.length > 0) {
                        this.displaySuggestions(matches);
                    } else {
                        this.hideSuggestions();
                    }
                }, 300);
            }

            displaySuggestions(suggestions) {
                this.searchSuggestions.innerHTML = '';
                suggestions.forEach(suggestion => {
                    const div = document.createElement('div');
                    div.className = 'search-suggestion';
                    div.textContent = suggestion;
                    div.addEventListener('click', () => {
                        this.messageInput.value = suggestion;
                        this.hideSuggestions();
                        this.adjustTextareaHeight();
                        this.updateSendButtonState();
                        this.messageInput.focus();
                    });
                    this.searchSuggestions.appendChild(div);
                });
                this.searchSuggestions.style.display = 'block';
            }

            hideSuggestions() {
                this.searchSuggestions.style.display = 'none';
            }

            handleSmartFormatting() {
                const text = this.messageInput.value.toLowerCase().trim();
                
                // Show real-time formatting hints
                if (text.match(/^(madurai|chennai|london|tokyo|mumbai|delhi) weather$/)) {
                    const location = text.split(' ')[0];
                    this.showFormattingSuggestion(`Try: "Weather in ${location.charAt(0).toUpperCase() + location.slice(1)}"`);
                } else if (text === 'weather') {
                    this.showFormattingSuggestion('Try: "Weather in Madurai" or specify your location');
                } else {
                    this.hideFormattingSuggestion();
                }
            }

            applySmartFormatting() {
                const text = this.messageInput.value.trim();
                const lowerText = text.toLowerCase();
                
                // Auto-format weather queries
                if (lowerText.match(/^(madurai|chennai|london|tokyo|mumbai|delhi) weather$/)) {
                    const location = lowerText.split(' ')[0];
                    this.messageInput.value = `Weather in ${location.charAt(0).toUpperCase() + location.slice(1)}`;
                    this.showNotification(`✨ Auto-formatted: "${this.messageInput.value}"`, 'info', 2000);
                } else if (lowerText === 'weather') {
                    this.messageInput.value = 'Weather in Madurai';
                    this.showNotification('✨ Auto-completed with default location: Madurai', 'info', 2000);
                }
                
                this.hideFormattingSuggestion();
            }

            showFormattingSuggestion(suggestion) {
                if (!this.formatHint) {
                    this.formatHint = document.createElement('div');
                    this.formatHint.className = 'format-hint';
                    this.formatHint.style.cssText = `
                        position: absolute;
                        bottom: 100%;
                        left: 0;
                        right: 0;
                        background: rgba(42, 117, 255, 0.1);
                        border: 1px solid rgba(42, 117, 255, 0.2);
                        border-radius: 8px;
                        padding: 0.5rem;
                        font-size: 0.8rem;
                        color: var(--primary-color);
                        z-index: 99;
                        animation: fadeIn 0.2s ease;
                    `;
                    this.messageInput.parentElement.appendChild(this.formatHint);
                }
                this.formatHint.textContent = `💡 ${suggestion}`;
                this.formatHint.style.display = 'block';
            }

            hideFormattingSuggestion() {
                if (this.formatHint) {
                    this.formatHint.style.display = 'none';
                }
            }

            showNotification(message, type = 'info', duration = 4000) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    ${message}
                    <button class="notification-close" onclick="this.parentElement.remove()">×</button>
                `;
                
                this.notificationsContainer.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, duration);
            }

            async sendMessage() {
                const text = this.messageInput.value.trim();
                if (!text || this.isTyping) return;

                // Add user message
                this.addMessage(text, 'user');
                this.messageInput.value = '';
                this.adjustTextareaHeight();
                this.updateSendButtonState();
                this.hideSuggestions();

                // Show typing indicator
                this.showTyping();

                try {
                    const response = await fetch('/api/ask', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ input: text })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    // Simulate realistic typing delay
                    await this.simulateTypingDelay(data.response);
                    
                    this.hideTyping();
                    this.addMessage(data.response, 'bot');
                    
                } catch (error) {
                    console.error('Error:', error);
                    this.hideTyping();
                    this.addMessage('Sorry, I encountered an error. Please try again.', 'bot', true);
                    this.showNotification('Connection error. Please check your internet.', 'error');
                }
            }

            async simulateTypingDelay(message) {
                // Simulate realistic typing based on message length
                const baseDelay = 500;
                const charDelay = message.length * 20;
                const totalDelay = Math.min(baseDelay + charDelay, 3000);
                
                return new Promise(resolve => setTimeout(resolve, totalDelay));
            }

            addMessage(text, sender, isError = false) {
                // Remove welcome message if it exists
                const welcomeMessage = this.chatMessages.querySelector('.welcome-message');
                if (welcomeMessage) {
                    welcomeMessage.remove();
                }

                const messageEl = document.createElement('div');
                messageEl.className = `message ${sender}`;
                
                const avatar = document.createElement('div');
                avatar.className = 'message-avatar';
                avatar.innerHTML = sender === 'user' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';
                
                const content = document.createElement('div');
                content.className = 'message-content';
                if (isError) content.style.borderLeft = '4px solid var(--danger-color)';
                
                // Format message with basic markdown-like support
                content.innerHTML = this.formatMessage(text);
                
                // Add timestamp
                const timestamp = document.createElement('div');
                timestamp.className = 'message-timestamp';
                timestamp.textContent = new Date().toLocaleTimeString();
                content.appendChild(timestamp);
                
                // Add message actions for bot messages
                if (sender === 'bot') {
                    const actions = document.createElement('div');
                    actions.className = 'message-actions';
                    actions.innerHTML = `
                        <button class="action-btn" onclick="copyMessage(this)" title="Copy message">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="action-btn" onclick="shareMessage(this)" title="Share message">
                            <i class="fas fa-share"></i>
                        </button>
                    `;
                    content.appendChild(actions);
                    
                    // Add suggestion chips for bot responses
                    if (!isError) {
                        setTimeout(() => this.addSuggestionChips(messageEl), 1000);
                    }
                }
                
                messageEl.appendChild(avatar);
                messageEl.appendChild(content);
                
                this.chatMessages.appendChild(messageEl);
                this.scrollToBottom();
            }

            addSuggestionChips(messageEl) {
                const suggestions = [
                    "Tell me more",
                    "What else can you help with?",
                    "Any tips?",
                    "Thanks!"
                ];
                
                const chipContainer = document.createElement('div');
                chipContainer.className = 'suggestion-chips';
                
                suggestions.slice(0, 2).forEach(suggestion => {
                    const chip = document.createElement('span');
                    chip.className = 'suggestion-chip';
                    chip.textContent = suggestion;
                    chip.onclick = () => {
                        this.messageInput.value = suggestion;
                        this.sendMessage();
                    };
                    chipContainer.appendChild(chip);
                });
                
                messageEl.appendChild(chipContainer);
            }

            formatMessage(text) {
                // Basic formatting for better readability
                return text
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/`(.*?)`/g, '<code style="background: #f8f9fa; padding: 2px 4px; border-radius: 3px; font-family: monospace;">$1</code>')
                    .replace(/\n/g, '<br>');
            }

            showTyping() {
                this.isTyping = true;
                this.typingIndicator.style.display = 'flex';
                this.updateSendButtonState();
                this.scrollToBottom();
            }

            hideTyping() {
                this.isTyping = false;
                this.typingIndicator.style.display = 'none';
                this.updateSendButtonState();
            }

            scrollToBottom() {
                setTimeout(() => {
                    this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
                }, 100);
            }

            toggleTheme(save = true) {
                const body = document.body;
                const container = document.querySelector('.chat-container');
                const button = document.querySelector('.theme-toggle i');
                
                body.classList.toggle('dark-theme');
                container.classList.toggle('dark-theme');
                
                if (body.classList.contains('dark-theme')) {
                    button.className = 'fas fa-sun';
                    if (save) localStorage.setItem('buddyTheme', 'dark');
                } else {
                    button.className = 'fas fa-moon';
                    if (save) localStorage.setItem('buddyTheme', 'light');
                }
            }
        }

        // Global utility functions
        function toggleTheme() {
            if (chatUI) {
                chatUI.toggleTheme();
            }
        }

        function toggleVoiceRecording() {
            if (!chatUI.recognition) {
                chatUI.showNotification('Voice recognition not supported in this browser', 'error');
                return;
            }

            if (chatUI.isRecording) {
                chatUI.stopVoiceRecording();
            } else {
                chatUI.startVoiceRecording();
            }
        }

        function copyMessage(button) {
            const messageContent = button.closest('.message-content');
            const text = messageContent.querySelector('div:not(.message-actions):not(.message-timestamp)').textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                chatUI.showNotification('Message copied to clipboard!', 'success');
            }).catch(() => {
                chatUI.showNotification('Failed to copy message', 'error');
            });
        }

        function shareMessage(button) {
            const messageContent = button.closest('.message-content');
            const text = messageContent.querySelector('div:not(.message-actions):not(.message-timestamp)').textContent;
            
            if (navigator.share) {
                navigator.share({
                    title: 'BUDDY AI Response',
                    text: text
                });
            } else {
                copyMessage(button);
                chatUI.showNotification('Message copied for sharing!', 'success');
            }
        }

        // Add voice recording methods to BuddyChatUI class
        BuddyChatUI.prototype.startVoiceRecording = function() {
            if (this.isRecording) return;
            
            this.isRecording = true;
            const voiceButton = document.getElementById('voiceButton');
            voiceButton.classList.add('active');
            voiceButton.querySelector('i').className = 'fas fa-stop';
            
            this.recognition.start();
            this.showNotification('Voice recording started. Speak now...', 'info');
        };

        BuddyChatUI.prototype.stopVoiceRecording = function() {
            if (!this.isRecording) return;
            
            this.isRecording = false;
            const voiceButton = document.getElementById('voiceButton');
            voiceButton.classList.remove('active');
            voiceButton.querySelector('i').className = 'fas fa-microphone';
            
            if (this.recognition) {
                this.recognition.stop();
            }
        };

        // Enhanced feature interaction functions with usage tracking
        const featureQueries = {
            weather: [
                "What's the weather in Chennai?",
                "Weather in Madurai",
                "Today's weather forecast",
                "Weather conditions now",
                "Tomorrow's weather",
                "Weekly weather outlook",
                "Is it going to rain today?",
                "Weather in London",
                "Weather in Tokyo",
                "Current temperature",
                "Humidity levels",
                "Wind speed and direction"
            ],
            tasks: [
                "Show my tasks",
                "Add task: Call the dentist",
                "Create new to-do list",
                "What tasks do I have?",
                "Mark task as complete",
                "Set reminder for tomorrow",
                "Priority tasks today",
                "Overdue tasks",
                "Task categories"
            ],
            calendar: [
                "Show my calendar",
                "What's my schedule today?",
                "Add meeting tomorrow at 2 PM",
                "Free time this week",
                "Schedule appointment",
                "Cancel meeting",
                "Next appointment",
                "Weekly schedule",
                "Meeting reminders"
            ],
            datetime: [
                "What time is it?",
                "Current date and time",
                "Time in different timezones",
                "Days until weekend",
                "Time in Tokyo",
                "Set an alarm for 7 AM",
                "Time zone converter",
                "Date calculator",
                "Working hours left today"
            ],
            entertainment: [
                "Tell me a programming joke",
                "Inspire me with a quote",
                "Random fun fact",
                "Motivational quote",
                "Tell me a story",
                "What's trending in tech?",
                "Daily inspiration",
                "Tech news",
                "Random trivia"
            ],
            notes: [
                "Show my notes",
                "Save note: Meeting summary",
                "Find notes about project",
                "Create new note",
                "Search my notes",
                "Delete old notes",
                "Note categories",
                "Recent notes",
                "Important notes"
            ],
            contacts: [
                "Show my contacts",
                "Add contact: Sarah Johnson",
                "Find John's phone number",
                "Contact management",
                "Update contact info",
                "Group contacts by category",
                "Recent contacts",
                "Favorite contacts",
                "Contact search"
            ],
            ai: [
                "What can you help me with?",
                "Explain artificial intelligence",
                "Help me plan my day",
                "Research latest tech trends",
                "Solve this problem",
                "Give me advice",
                "Learning recommendations",
                "Career guidance",
                "Technology insights"
            ]
        };

        // Usage tracking
        let featureUsage = JSON.parse(localStorage.getItem('buddyFeatureUsage') || '{}');

        function handleFeatureClick(category) {
            const queries = featureQueries[category];
            let randomQuery = queries[Math.floor(Math.random() * queries.length)];
            
            // Special handling for weather category to prioritize Madurai
            if (category === 'weather') {
                const weatherQueries = [
                    "Weather in Madurai",
                    "What's the weather in Madurai?", 
                    "Current temperature in Madurai",
                    "Madurai weather forecast",
                    "Weather in Chennai",
                    "Weather in London",
                    "Weather in Tokyo"
                ];
                randomQuery = weatherQueries[Math.floor(Math.random() * weatherQueries.length)];
            }
            
            // Update usage count
            featureUsage[category] = (featureUsage[category] || 0) + 1;
            localStorage.setItem('buddyFeatureUsage', JSON.stringify(featureUsage));
            
            // Update usage indicator
            updateUsageIndicator(category);
            
            // Add visual feedback with category-specific colors
            const card = event.currentTarget;
            const originalTransform = card.style.transform;
            card.style.transform = 'scale(0.95)';
            
            // Category-specific feedback colors
            const categoryColors = {
                weather: 'rgba(30, 144, 255, 0.2)',
                tasks: 'rgba(138, 43, 226, 0.2)',
                calendar: 'rgba(34, 139, 34, 0.2)',
                datetime: 'rgba(255, 140, 0, 0.2)',
                entertainment: 'rgba(255, 215, 0, 0.2)',
                notes: 'rgba(219, 112, 147, 0.2)',
                contacts: 'rgba(32, 178, 170, 0.2)',
                ai: 'rgba(138, 43, 226, 0.2)'
            };
            
            card.style.background = categoryColors[category] || 'rgba(42, 117, 255, 0.1)';
            
            setTimeout(() => {
                card.style.transform = originalTransform;
                card.style.background = '';
            }, 200);
            
            // Send the query with smart formatting
            sendQuickMessage(randomQuery);
            
            // Show enhanced notification with location for weather
            if (category === 'weather' && randomQuery.includes('Madurai')) {
                chatUI.showNotification(`🌤️ Checking Madurai weather conditions...`, 'success', 3000);
            } else {
                chatUI.showNotification(`${category.charAt(0).toUpperCase() + category.slice(1)} feature activated!`, 'success');
            }
        }

        function updateUsageIndicator(category) {
            const card = document.querySelector(`[data-category="${category}"]`);
            if (card) {
                const indicator = card.querySelector('.feature-usage-indicator');
                if (indicator) {
                    indicator.textContent = featureUsage[category] || 0;
                }
            }
        }

        function showFeaturePreview(category) {
            const card = event.currentTarget;
            const example = card.querySelector('.feature-example');
            
            // Add glow effect
            card.style.boxShadow = '0 0 25px rgba(42, 117, 255, 0.4)';
            
            // Show random example with animation
            if (example && featureQueries[category]) {
                const queries = featureQueries[category];
                const randomQuery = queries[Math.floor(Math.random() * queries.length)];
                example.style.opacity = '1';
                example.style.transform = 'translateY(0) scale(1.05)';
            }
        }

        function hideFeaturePreview() {
            const card = event.currentTarget;
            card.style.boxShadow = '';
            
            const example = card.querySelector('.feature-example');
            if (example) {
                example.style.opacity = '';
                example.style.transform = '';
            }
        }

        // Enhanced keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.altKey) {
                const shortcuts = {
                    'w': 'weather', 't': 'tasks', 'c': 'calendar', 'd': 'datetime',
                    'e': 'entertainment', 'n': 'notes', 'o': 'contacts', 'a': 'ai'
                };
                
                if (shortcuts[e.key.toLowerCase()]) {
                    e.preventDefault();
                    const category = shortcuts[e.key.toLowerCase()];
                    handleFeatureClick(category);
                }
            }
            
            // ESC to stop voice recording
            if (e.key === 'Escape' && chatUI.isRecording) {
                chatUI.stopVoiceRecording();
            }
        });

        // Enhanced quick message function with smart location detection
        function sendQuickMessage(message) {
            const input = document.getElementById('messageInput');
            
            // Smart location detection for weather queries
            if (message.toLowerCase().includes('weather') && !message.toLowerCase().includes(' in ')) {
                // If user just typed "weather" or "madurai weather", auto-format it
                const locationMatch = message.match(/(madurai|chennai|london|tokyo|mumbai|delhi|bangalore|paris|sydney)/i);
                if (locationMatch) {
                    message = `What's the weather in ${locationMatch[1]}?`;
                } else if (message.toLowerCase() === 'weather') {
                    message = "What's the weather in Madurai?"; // Default to Madurai
                }
            }
            
            input.value = message;
            
            // Add enhanced typing animation with location awareness
            input.style.transform = 'scale(1.05)';
            input.style.background = 'rgba(42, 117, 255, 0.1)';
            input.style.borderColor = 'var(--primary-color)';
            
            // Show location detected notification for weather queries
            if (message.toLowerCase().includes('weather in')) {
                const location = message.match(/weather in (\w+)/i);
                if (location) {
                    chatUI.showNotification(`🌍 Location detected: ${location[1]}`, 'success', 2000);
                }
            }
            
            setTimeout(() => {
                input.style.transform = '';
                input.style.background = '';
                input.style.borderColor = '';
                chatUI.sendMessage();
            }, 300);
        }

        // Initialize chat UI when DOM is loaded
        let chatUI;
        document.addEventListener('DOMContentLoaded', () => {
            chatUI = new BuddyChatUI();
            
            // Load usage indicators
            Object.keys(featureUsage).forEach(category => {
                updateUsageIndicator(category);
            });
            
            // Welcome notification
            setTimeout(() => {
                chatUI.showNotification('Welcome to BUDDY AI! Try voice commands or click feature cards.', 'success', 6000);
            }, 1000);
        });

        // Service Worker for offline support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/sw.js').catch(() => {
                    console.log('Service Worker registration failed');
                });
            });
        }

        // Auto-save conversation
        setInterval(() => {
            const messages = Array.from(document.querySelectorAll('.message')).map(msg => ({
                type: msg.classList.contains('user') ? 'user' : 'bot',
                content: msg.querySelector('.message-content').textContent,
                timestamp: new Date().toISOString()
            }));
            
            localStorage.setItem('buddyConversation', JSON.stringify(messages.slice(-50))); // Keep last 50 messages
        }, 30000); // Save every 30 seconds
    </script>
</body>
</html>
